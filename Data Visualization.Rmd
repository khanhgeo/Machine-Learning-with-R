---
title: "DASC 5420 - Exercise 1"
author: "Khanh Tran - T00711160"
date: "2023-01-21"
output:
  html_document: 
    toc: yes
    toc_depth: 2
  pdf_document: default
---

```{r include=FALSE}
knitr::opts_chunk$set(message = FALSE, warning = FALSE)
```



# Chapter 3 Data visualization

## 3.1 Introduction

### 3.1.1 Prerequisites

Install and Load Required Libraries
```{r, results='hide'}
# install and call required library
pkg_list = c('tidyverse', 'quantmod')
# Install packages if needed
for (pkg in pkg_list)
  {# Try loading the library.
    if ( ! library(pkg, logical.return=TRUE, character.only=TRUE) )
      {
        # If the library cannot be loaded, install it; then load.
        install.packages(pkg)
        library(pkg, character.only=TRUE)
      }
  }
```


## 3.2 First steps

### 3.2.1 The mpg data frame
```{r}
# display mpg dataframe
mpg
```

### 3.2.2 Creating a ggplot

```{r}
# create mpg ggplot
ggplot(data = mpg) +
  geom_point(mapping = aes(x = displ, y = hwy))
```

### 3.2.3 A graphing template

```{r,  eval = FALSE}
ggplot(data = <DATA>) + 
  <GEOM_FUNCTION>(mapping = aes(<MAPPINGS>))
```


### 3.2.4 Exercises

1 . Run `ggplot(data = mpg)`. What do you see?

This code creates an empty plot.
```{r}
ggplot(data = mpg)
```

2 . How many rows are in `mpg`? How many columns?

Number of row in mpg dataset is: `r nrow(mpg)`
```{r}
nrow(mpg)
```

Number of columns in mpg dataset: `r ncol(mpg)`
```{r}
ncol(mpg)
```


3 . What does the `drv` variable describe? Read the help for `?mpg` to find out.

`drv` is the type of drive train, where f = front-wheel drive, r = rear wheel drive, 4 = 4wd


4 . Make a scatterplot of `hwy` vs `cyl`.
```{r}
ggplot(data = mpg) + 
  geom_point(mapping = aes(x = hwy, y = factor(cyl))) +
  labs(title = "Scatterplot of HWY vs CYL",
       x = "Highway (miles per gallon)",
       y = "Number of Cylinders")
```

5 . What happens if you make a scatterplot of `class` vs `drv`? Why is the plot not useful?
```{r}
ggplot(data = mpg) +
  geom_point(mapping = aes(x = class, y = drv)) + 
  labs(title = "Scatterplot of Class vs Drv",
       x = "Type of Car",
       y = "Type of Drive Train")
```

A scatter plot is not a practical way to represent these two categorical variables class, drv. Since categorical variables typically only take a certain set of values, there are a limited number of unique combinations of (x, y) values that may be shown.


## 3.3 Aesthetic mappings

*colors* by the class variable
```{r}
ggplot(data = mpg) + 
  geom_point(mapping = aes(x = displ, y = hwy, color = class))
```

*size* by the class variable
```{r}
ggplot(data = mpg) + 
  geom_point(mapping = aes(x = displ, y = hwy, size = class))
```

*alpha* by the class variable
```{r}
ggplot(data = mpg) + 
  geom_point(mapping = aes(x = displ, y = hwy, alpha = class))
```

*shape* by the class variable
```{r}
ggplot(data = mpg) + 
  geom_point(mapping = aes(x = displ, y = hwy, shape = class))
```

*color* all points by blue
```{r}
ggplot(data = mpg) + 
  geom_point(mapping = aes(x = displ, y = hwy), color = "blue")
```


### 3.3.1 Exercises

1 . What’s gone wrong with this code? Why are the points not blue?

`aes()` is used to map variable in the data, in order to make all points are *blue*, we need to move argument `color = "blue"` out side of `aes()` 

```{r}
ggplot(data = mpg) + 
  geom_point(mapping = aes(x = displ, y = hwy, color = "blue"))
```

2 . Which variables in mpg are categorical? Which variables are continuous? (Hint: type ?mpg to read the documentation for the dataset). How can you see this information when you run mpg?

`mpg` dataset contains categorical variables: manufacturer, model, trans, drv, fl and class . While displ, year, cyl, cty and hwy are continues variables. Variables with <chr> above their columns are categorical, while those with <dbl> or <int> are continuous

3 . Map a continuous variable to color, size, and shape. How do these aesthetics behave differently for categorical vs. continuous variables?

It works when map a continuous variable to color and size, but it gives an error when map to shape. 

4 . What happens if you map the same variable to multiple aesthetics?

It works. However, it provides a redundant information. Therefore, it is not recommended.

5 . What does the stroke aesthetic do? What shapes does it work with? (Hint: use ?geom_point)

```{r}
ggplot(data = mpg, mapping = aes(x = displ, y = hwy)) +
  geom_point(shape = 21, colour = "black", fill = "white", size = 5, stroke = 5)
```

Stroke is used to modifies the size of shape boundaries.

6 . What happens if you map an aesthetic to something other than a variable name, like aes(colour = displ < 5)? Note, you’ll also need to specify x and y.

```{r}
ggplot(data = mpg, aes(x = displ, y = hwy, colour = displ < 5)) + 
  geom_point()
```

argument `displ < 5` result a logical variable which takes values of TRUE or FALSE. 


## 3.4 Common problems

One common problem when creating ggplot2 graphics is to put the + in the wrong place. Make sure you haven’t accidentally written code like this:
```{r setup, eval=FALSE}
ggplot(data = mpg) 
+ geom_point(mapping = aes(x = displ, y = hwy))
```



## 3.5 Facets

Use `facet_wrap()` to facet plot by a single discrete variable
```{r}
ggplot(data = mpg) + 
  geom_point(mapping = aes(x = displ, y = hwy)) + 
  facet_wrap(~ class, nrow = 2)
```

Use `facet_grid()` to facet plot on the combination of two variables
```{r}
ggplot(data = mpg) + 
  geom_point(mapping = aes(x = displ, y = hwy)) + 
  facet_grid(drv ~ cyl)
```

### 3.5.1 Exercises

1 . What happens if you facet on a continuous variable?
```{r}
ggplot(data = mpg) + 
  geom_point(mapping = aes(x = displ, y = hwy)) + 
  facet_wrap(. ~ cty, nrow = 1)
```

The continuous variable is transformed into a categorical variable, with a facet for each unique value in the plot.

2 . What do the empty cells in plot with facet_grid(drv ~ cyl) mean? How do they relate to this plot?

```{r}
ggplot(data = mpg) + 
  geom_point(mapping = aes(x = drv, y = cyl))
```
```{r}
ggplot(data = mpg) + 
  geom_point(mapping = aes(x = displ, y = cty)) +
  facet_grid(drv ~ cyl)
```

The empty cells (facets) in this diagram correspond to the combinations of drv and cyl that have no observations. The same regions with no points on the drv and cyl scatter plot are present here.

3 . What plots does the following code make? What does . do?

```{r}
ggplot(data = mpg) + 
  geom_point(mapping = aes(x = displ, y = hwy)) +
  facet_grid(drv ~ .)

ggplot(data = mpg) + 
  geom_point(mapping = aes(x = displ, y = hwy)) +
  facet_grid(. ~ cyl)
```

The symbol . ignores that dimension when faceting. Taking above codes as examples, facet_grid(drv ~ .) facet by values of drv on the y-axis and facet_grid(. ~ cyl) facet by values of cyl on the x-axis.

4 . Take the first faceted plot in this section:

```{r}
ggplot(data = mpg) + 
  geom_point(mapping = aes(x = displ, y = hwy)) + 
  facet_wrap(~ class, nrow = 2)
```

What are the advantages to using faceting instead of the colour aesthetic? What are the disadvantages? How might the balance change if you had a larger dataset?

It is more easy to distinguish class by using facet than using color aesthetic. However, the disadvantage of faceting is that it is difficult to compare between class.

5 . Read ?facet_wrap. What does nrow do? What does ncol do? What other options control the layout of the individual panels? Why doesn’t facet_grid() have nrow and ncol arguments?

nrow and ncol arguments use to define the number of rows and columns when layingout the facet. `facet_grid()` uses number of unique values of the variables specified in the function to determine the number of rows and columns, therefore, nrow and ncol arguments are not necessary.

6 . When using facet_grid() you should usually put the variable with more unique levels in the columns. Why?

Variable with more unique levels requires more space so put it in the columns would be more reasonable.



## 3.6 Geometric objects

*geom_point()*
```{r}
# left
ggplot(data = mpg) + 
  geom_point(mapping = aes(x = displ, y = hwy))
```

*geom_smooth()*
```{r}
# right
ggplot(data = mpg) + 
  geom_smooth(mapping = aes(x = displ, y = hwy))
```

*geom_smooth() with linetyle*
```{r}
ggplot(data = mpg) + 
  geom_smooth(mapping = aes(x = displ, y = hwy, linetype = drv))
```

single geometric object geom_smooth()
```{r}
ggplot(data = mpg) +
  geom_smooth(mapping = aes(x = displ, y = hwy))
```

set the *group* aesthetic to a categorical variable to draw multiple objects
```{r}
ggplot(data = mpg) +
  geom_smooth(mapping = aes(x = displ, y = hwy, group = drv))
```

automatically group the data for geoms when mapping an aesthetic to a discrete variable
```{r}
ggplot(data = mpg) +
  geom_smooth(
    mapping = aes(x = displ, y = hwy, color = drv),
    show.legend = FALSE
  )
```

display multiple *geoms* in the same plot
```{r}
ggplot(data = mpg) + 
  geom_point(mapping = aes(x = displ, y = hwy)) +
  geom_smooth(mapping = aes(x = displ, y = hwy))
```

global and local mappings
```{r}
ggplot(data = mpg, mapping = aes(x = displ, y = hwy)) + 
  geom_point(mapping = aes(color = class)) + 
  geom_smooth()
```

local mapping geom_smooth line displays just a subset of the mpg dataset
```{r}
ggplot(data = mpg, mapping = aes(x = displ, y = hwy)) + 
  geom_point(mapping = aes(color = class)) + 
  geom_smooth(data = filter(mpg, class == "subcompact"), se = FALSE)
```

### 3.6.1 Exercises

1 . What geom would you use to draw a line chart? A boxplot? A histogram? An area chart?

- line chart: geom_line()
- boxplot: geom_boxplot()
- histogram: geom_histogram()
- area chart: geom_area()

2 . Run this code in your head and predict what the output will look like. Then, run the code in R and check your predictions.

```{r}
ggplot(data = mpg, mapping = aes(x = displ, y = hwy, color = drv)) + 
  geom_point() + 
  geom_smooth(se = FALSE)
```

3 . What does show.legend = FALSE do? What happens if you remove it? Why do you think I used it earlier in the chapter?

`show.legend = FALSE` mean do not show the legend box. By contrast, when remove it will show the legend box.

4 . What does the se argument to geom_smooth() do?

It adds standard error band to the line.

5 . Will these two graphs look different? Why/why not?

```{r}
ggplot(data = mpg, mapping = aes(x = displ, y = hwy)) + 
  geom_point() + 
  geom_smooth()

ggplot() + 
  geom_point(data = mpg, mapping = aes(x = displ, y = hwy)) + 
  geom_smooth(data = mpg, mapping = aes(x = displ, y = hwy))
```

There is no different since both plot use the same data mapping. The first one use global mapping while the second one use local mapping, but they map the same data.

6 . Recreate the R code necessary to generate the following graphs.

```{r}
ggplot(data = mpg, aes(x = displ, y = hwy)) + 
  geom_point() +
  geom_smooth(se = F)
```
```{r}
ggplot(data = mpg, aes(x = displ, y = hwy)) + 
  geom_point() +
  geom_smooth(aes(group = drv), se = F)
```
```{r}
ggplot(data = mpg, aes(x = displ, y = hwy, color = drv)) + 
  geom_point() +
  geom_smooth(se = F)
```
```{r}
ggplot(data = mpg, aes(x = displ, y = hwy)) + 
  geom_point(aes(color = drv)) +
  geom_smooth(aes(linetype = drv) ,se = F)
```
```{r}
ggplot(data = mpg, aes(x = displ, y = hwy)) + 
  geom_point(aes(color = drv)) +
  geom_smooth(se = F)
```
```{r}
ggplot(data = mpg, aes(x = displ, y = hwy)) + 
  geom_point(color = "white", size = 4) +
  geom_point(aes(color = drv))
```



## 3.7 Statistical transformations

bar chart by geom_bar()
```{r}
ggplot(data = diamonds) + 
  geom_bar(mapping = aes(x = cut))
```

bar chart by stat_count()
```{r}
ggplot(data = diamonds) + 
  stat_count(mapping = aes(x = cut))
```

change the stat of geom_bar() from count (the default) to identity
```{r}
demo <- tribble(
  ~cut,         ~freq,
  "Fair",       1610,
  "Good",       4906,
  "Very Good",  12082,
  "Premium",    13791,
  "Ideal",      21551
)

ggplot(data = demo) +
  geom_bar(mapping = aes(x = cut, y = freq), stat = "identity")
```

override the default mapping from transformed variables to aesthetics
```{r}
ggplot(data = diamonds) + 
  geom_bar(mapping = aes(x = cut, y = stat(prop), group = 1))
```

`stat_summary()` to summaries the y values 
```{r}
ggplot(data = diamonds) + 
  stat_summary(
    mapping = aes(x = cut, y = depth),
    fun.min = min,
    fun.max = max,
    fun = median
  )
```

### 3.7.1 Exercises

1 . What is the default geom associated with stat_summary()? How could you rewrite the previous plot to use that geom function instead of the stat function?

`geom_pointrange()` is the default geom for `stat_summary()`.
```{r}
ggplot(data = diamonds) + 
  geom_pointrange(
    mapping = aes(x = cut, y = depth),
    stat = "summary",
    fun.min = min,
    fun.max = max,
    fun = median
  )
```


2 . What does geom_col() do? How is it different to geom_bar()?

`geom_col()` and `geom_bar()` use different default *stat* function. The former uses `stat_identity()` and the later use `stat_count()`.

3 . Most geoms and stats come in pairs that are almost always used in concert. Read through the documentation and make a list of all the pairs. What do they have in common?

Some geoms and stats pairs: 

- geom_bar()	stat_count()
- geom_boxplot()	stat_boxplot()
- geom_smooth()	stat_smooth()

Those pairs tend to have common names.

4 . What variables does stat_smooth() compute? What parameters control its behaviour?

The function stat_smooth() calculates the following variables:

- y: predicted value
- ymin: lower value of the confidence interval
- ymax: upper value of the confidence interval
- se: standard error

Parameters control the behavior of `stat_smooth()` include: method, formula, method.arg(), se and na.rm.

5 . In our proportion bar chart, we need to set group = 1. Why? In other words what is the problem with these two graphs?

All bars in the plot will have the same height, if group = 1 is not included. Since the stat computes the counts inside each group, the geom bar() function presupposes that the groups are identical to the x values. The issue with these two plots is that the proportions are calculated inside the groupings.

```{r}
ggplot(data = diamonds) + 
  geom_bar(mapping = aes(x = cut, y = after_stat(prop)))
ggplot(data = diamonds) + 
  geom_bar(mapping = aes(x = cut, fill = color, y = after_stat(prop)))
```



## 3.8 Position adjustments

Colour a bar chart using `colour` aesthetic
```{r}
ggplot(data = diamonds) + 
  geom_bar(mapping = aes(x = cut, colour = cut))
```

Colour a bar chart using *fill*
```{r}
ggplot(data = diamonds) + 
  geom_bar(mapping = aes(x = cut, fill = cut))
```

Bars are automatically stacked when mapping the fill aesthetic to another variable
```{r}
ggplot(data = diamonds) + 
  geom_bar(mapping = aes(x = cut, fill = clarity))
```

The stacking is performed automatically by the position adjustment specified by the position argument. Do not stack bar chart by use one of three other options: "identity", "dodge" or "fill".

position = "identity"
```{r}
ggplot(data = diamonds, mapping = aes(x = cut, fill = clarity)) + 
  geom_bar(alpha = 1/5, position = "identity")
```

position = "identity"
```{r}
ggplot(data = diamonds, mapping = aes(x = cut, colour = clarity)) + 
  geom_bar(fill = NA, position = "identity")
```

position = "fill"
```{r}
ggplot(data = diamonds) + 
  geom_bar(mapping = aes(x = cut, fill = clarity), position = "fill")
```

position = "dodge"
```{r}
ggplot(data = diamonds) + 
  geom_bar(mapping = aes(x = cut, fill = clarity), position = "dodge")
```

position = "jitter"
```{r}
ggplot(data = mpg) + 
  geom_point(mapping = aes(x = displ, y = hwy), position = "jitter")
```


### 3.8.1 Exercises

1 . What is the problem with this plot? How could you improve it?
```{r}
ggplot(data = mpg, mapping = aes(x = cty, y = hwy)) + 
  geom_point()
```

The problem is that there are multiple observations at many combinations of cty and hwy locations. This issue can be improve by using jitter position adjustment.

```{r}
ggplot(data = mpg, mapping = aes(x = cty, y = hwy)) +
  geom_point(position = "jitter")
```


2 . What parameters to geom_jitter() control the amount of jittering?

width and height are two arguments to jitter:

- width controls the amount of horizontal displacement.
- height controls the amount of vertical displacement.


3 . Compare and contrast geom_jitter() with geom_count().

geom_jitter() slightly changes the locations of the points by adding in some random variation. Whereas the geom_count() does not change the coordinates of the points, the size of points is proportional to the number of observations at the point location.

4 . What’s the default position adjustment for geom_boxplot()? Create a visualisation of the mpg dataset that demonstrates it.

position_dodge2 is default position adjustment for geom_boxplot(). This position adjustment shifts a geom horizontally rather than vertically in order to prevent it from overlapping another geom.

geom_boxplot() with default position adjustment 
```{r}
ggplot(data = mpg, mapping = aes(x = drv, y = hwy, colour = class)) +
  geom_boxplot()
```

geom_boxplot() change the adjustment
```{r}
ggplot(data = mpg, mapping = aes(x = drv, y = hwy, colour = class)) +
  geom_boxplot(position = "identity")
```


## 3.9 Coordinate systems

`geom_boxplot()`
```{r}
ggplot(data = mpg, mapping = aes(x = class, y = hwy)) + 
  geom_boxplot()
```

`coord_flip()` switches the x and y axes
```{r}
ggplot(data = mpg, mapping = aes(x = class, y = hwy)) + 
  geom_boxplot() +
  coord_flip()
```

`geom_polygon()`
```{r}
nz <- map_data("nz")

ggplot(nz, aes(long, lat, group = group)) +
  geom_polygon(fill = "white", colour = "black")
```

`coord_quickmap()` sets the aspect ratio correctly for maps
```{r}
ggplot(nz, aes(long, lat, group = group)) +
  geom_polygon(fill = "white", colour = "black") +
  coord_quickmap()
```

bar + coord_flip()
```{r}
# coord_polar() function
bar <- ggplot(data = diamonds) + 
  geom_bar(
    mapping = aes(x = cut, fill = cut), 
    show.legend = FALSE,
    width = 1
  ) + 
  theme(aspect.ratio = 1) +
  labs(x = NULL, y = NULL)

bar + coord_flip()
```

`coord_polar()` uses polar coordinates
```{r}
bar + coord_polar()
```


### 3.9.1 Exercises

1 . Turn a stacked bar chart into a pie chart using coord_polar().

stacked bar chart
```{r}
ggplot(data = diamonds) + 
  geom_bar(mapping = aes(x = cut, fill = clarity), position = "fill")
```

turn stacked bar chart into pie chart
```{r}
ggplot(data = diamonds) + 
  geom_bar(mapping = aes(x = cut, fill = clarity), position = "fill") +
  coord_polar()
```


2 . What does labs() do? Read the documentation.

The labs function uses to adds plot titles, axis titles to the plot.

3 . What’s the difference between coord_quickmap() and coord_map()?

Both functions are used to project the three-dimensional Earth onto a two-dimensional plane. coord_map() uses the Mercator projection and coord_quickmap() use approximation projection therefore, coord_map() produce high projection accuracy but more computation time than coord_quickmap().

4 . What does the plot below tell you about the relationship between city and highway mpg? Why is coord_fixed() important? What does geom_abline() do?

city and highway have strong positive linear relationship. The coord_fixed() function ensures the line produced by geom_abline() is at a 45-degree angle which help us to easily compare two variables, particularly when two variables are almost equal.

```{r}
ggplot(data = mpg, mapping = aes(x = cty, y = hwy)) +
  geom_point() + 
  geom_abline() +
  coord_fixed()
```



## 3.10 The layered grammar of graphics

```{r, eval = FALSE}
ggplot(data = <DATA>) + 
  <GEOM_FUNCTION>(
     mapping = aes(<MAPPINGS>),
     stat = <STAT>, 
     position = <POSITION>
  ) +
  <COORDINATE_FUNCTION> +
  <FACET_FUNCTION>
```



# Stock Price

Get stock prices from Yahoo finance
```{r}
start.date = '2021-4-1' # starting date of stock
end.date = '2022-12-30' # ending date of stock
# Download the selected stocks from Yahoo finance
getSymbols(c('AAPL','MSFT','AMZN', 'GOOG', 'META'), 
              src = "yahoo", from = start.date, to = end.date)
```

Merge the adjusted prices only to mydata
```{r}
mydata <- merge(AAPL = AAPL[, "AAPL.Adjusted"], MSFT = MSFT[, "MSFT.Adjusted"], 
                AMZN = AMZN[, "AMZN.Adjusted"], GOOG = GOOG[, "GOOG.Adjusted"],
                META = META[, "META.Adjusted"])
```

Fine-tuned Stock Names 
```{r}
names(mydata) <- c("AAPL", "MSFT", "AMZN", "GOOG", "META")
```

Top 6 rows of mydata
```{r}
head(mydata)
```

Last 6 rows of mydata
```{r}
tail(mydata)
```

Plot Stock Prices
```{r}
plot(mydata, legend.loc=7,
     main="Stock Prices of Big Tech Companies",
     xlab = "Period",
     ylab = "Prices")
```
